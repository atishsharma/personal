<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMEGP Detailed Project Report - Cordyceps</title>
    <link rel="icon" type="image/png"
        href="https://pbs.twimg.com/profile_images/1530184439409815553/stAtZvyp_400x400.jpg">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tinos:wght@400;700&display=swap');

        :root {
            --paper-width: 210mm;
            --font-main: 'Tinos', 'Times New Roman', serif;
        }

        body {
            background-color: #525659;
            font-family: var(--font-main);
            color: #000;
            margin: 0;
            padding: 0;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        /* --- Control Panel --- */
        .control-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            font-family: sans-serif;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            border: 1px solid #ced4da;
            cursor: pointer;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            background: white;
            transition: all 0.2s;
        }

        .btn:hover {
            background-color: #e9ecef;
        }

        .btn-primary {
            background-color: #0d6efd;
            color: white;
            border-color: #0d6efd;
        }

        .btn-primary:hover {
            background-color: #0b5ed7;
        }

        .btn-add {
            background-color: #198754;
            color: white;
            border: none;
            padding: 5px 10px;
            font-size: 12px;
            margin-top: 5px;
            cursor: pointer;
        }

        /* --- Paper Layout --- */
        .paper-container {
            padding-top: 70px;
            padding-bottom: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .paper {
            background: white;
            width: var(--paper-width);
            min-height: 297mm;
            padding: 20mm;
            box-sizing: border-box;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* --- Title Page Styling (Centered Block) --- */
        .paper.title-page-paper {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .title-page-container {
            border: 3px double #000;
            padding: 40px;
            width: 90%;
            height: 85%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            text-align: center;
            box-sizing: border-box;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
        }

        .main-title-box {
            border: 4px solid #000;
            padding: 20px 40px;
            display: inline-block;
            margin-bottom: 20px;
            background-color: #fff;
        }

        .main-title {
            font-size: 34px;
            font-weight: bold;
            text-transform: uppercase;
            margin: 0;
            letter-spacing: 1.5px;
            text-decoration: none;
        }

        .sub-title {
            font-size: 22px;
            font-weight: bold;
            margin-top: 15px;
            color: #333;
        }

        .project-box {
            border-top: 2px solid #000;
            border-bottom: 2px solid #000;
            padding: 40px 0;
            margin: 30px 0;
        }

        .project-name {
            font-size: 32px;
            font-weight: bold;
            text-transform: uppercase;
            line-height: 1.4;
            margin-top: 10px;
        }

        /* --- Content Styling --- */
        h3.section-header {
            font-size: 16px;
            background-color: #e9ecef;
            padding: 8px 10px;
            margin-top: 25px;
            margin-bottom: 15px;
            border: 1px solid #000;
            text-transform: uppercase;
            font-weight: bold;
            -webkit-print-color-adjust: exact;
            break-after: avoid;
        }

        p,
        li {
            font-size: 15px;
            line-height: 1.9;
            text-align: justify;
            margin-bottom: 12px;
        }

        /* --- Tables --- */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 14px;
            border: 1px solid #000;
            break-inside: auto;
        }

        th,
        td {
            border: 1px solid #000;
            padding: 8px 10px;
            vertical-align: middle;
            line-height: 1.4;
        }

        th {
            background-color: #e9ecef !important;
            font-weight: bold;
            text-align: center;
            -webkit-print-color-adjust: exact;
        }

        /* Specific Alignment Classes */
        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .text-left {
            text-align: left;
        }

        .font-bold {
            font-weight: bold;
        }

        .amount-col {
            text-align: right;
            font-family: monospace;
            font-size: 14px;
        }

        /* Project at a Glance Specifics */
        .glance-table td:nth-child(1) {
            text-align: center;
            width: 50px;
        }

        .glance-table td:nth-child(2) {
            text-align: left;
            width: 40%;
        }

        .glance-table td:nth-child(3) {
            text-align: center;
            font-weight: bold;
        }

        /* --- Process List --- */
        .process-list {
            margin-left: 20px;
            padding-left: 0;
        }

        .process-list li {
            margin-bottom: 10px;
        }

        .process-title {
            font-weight: bold;
            text-decoration: underline;
        }

        /* --- Invoices --- */
        .invoice-box {
            border: 1px solid #000;
            padding: 30px;
            box-sizing: border-box;
            background: white;
        }

        .invoice-header {
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* --- Signature Block --- */
        .signature-block {
            margin-top: 50px;
            display: flex;
            justify-content: space-between;
            break-inside: avoid;
        }

        .sign-box {
            width: 200px;
            text-align: center;
        }

        .sign-line {
            border-top: 1px solid #000;
            padding-top: 5px;
            margin-top: 40px;
            font-weight: bold;
        }

        /* --- Editable --- */
        [contenteditable="true"]:hover {
            background-color: #ffffcc;
            outline: 1px dashed #ccc;
        }

        [contenteditable="true"]:focus {
            background-color: #e7f1ff;
            outline: 2px solid #0d6efd;
        }

        .delete-btn {
            color: red;
            cursor: pointer;
            font-weight: bold;
            margin-left: 5px;
        }

        /* --- PRINT CSS --- */
        @media print {
            body {
                background: white;
                margin: 0;
                padding: 0;
            }

            .control-panel,
            .no-print,
            .btn-add,
            .delete-btn {
                display: none !important;
            }

            .paper-container {
                display: block;
                margin: 0;
                padding: 0;
            }

            .paper.report-content {
                box-shadow: none;
                margin: 0;
                padding: 0;
                width: 100%;
                min-height: 0;
                border: none;
                page-break-after: auto;
                display: block;
            }

            .paper.title-page-paper {
                box-shadow: none;
                margin: 0;
                padding: 0;
                width: 100%;
                height: 100vh;
                page-break-after: always;
                border: none;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .paper.invoice-page {
                box-shadow: none;
                margin: 0;
                padding: 0;
                width: 100%;
                min-height: 100vh;
                page-break-before: always;
                border: none;
            }

            [contenteditable="true"]:hover,
            [contenteditable="true"]:focus {
                background: none;
                outline: none;
            }

            table {
                page-break-inside: auto;
                width: 100%;
            }

            tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }

            thead {
                display: table-header-group;
            }

            tfoot {
                display: table-footer-group;
            }

            @page {
                size: A4;
                margin: 15mm 20mm;
            }
        }
    </style>
</head>

<body>

    <div class="control-panel no-print">
        <div style="font-weight: bold;">
            <i class="fas fa-file-alt"></i> PMEGP Detailed Project Report
        </div>
        <div style="display: flex; gap: 10px;">
            <button onclick="calculateAll()" class="btn">
                <i class="fas fa-sync-alt"></i> Recalculate
            </button>
            <button onclick="window.print()" class="btn btn-primary">
                <i class="fas fa-download"></i> Download PDF
            </button>
        </div>
    </div>

    <div class="paper-container">

        <!-- TITLE PAGE (Separate Page) -->
        <div class="paper title-page-paper">
            <div class="title-page-container">
                <div style="margin-top: 20px;">
                    <div class="main-title-box">
                        <div class="main-title" contenteditable="true">Detailed Project Report</div>
                    </div>
                    <div class="sub-title" contenteditable="true">Submitted for Financial Assistance<br>Under PMEGP
                        Scheme</div>
                </div>

                <div class="project-box">
                    <div style="font-size: 18px; margin-bottom: 10px;">For Establishment of</div>
                    <div class="project-name" contenteditable="true">Cordyceps Militaris<br>Cultivation Unit</div>
                </div>

                <div
                    style="display: flex; justify-content: space-between; align-items: flex-end; padding: 0 20px; text-align: left; margin-bottom: 20px;">
                    <div style="width: 45%;">
                        <strong>Submitted By:</strong><br><br>
                        <div contenteditable="true" style="line-height: 1.6;">
                            <span style="font-size: 18px; font-weight: bold;">Mrs. Rajni Sheetal</span><br>
                            Proprietor<br>
                            Hamirpur, Himachal Pradesh
                        </div>
                    </div>

                    <div style="width: 45%; text-align: right;">
                        <strong>Submitted To:</strong><br><br>
                        <div contenteditable="true" style="line-height: 1.6;">
                            <span style="font-size: 18px; font-weight: bold;">The Branch Manager,</span><br>
                            State Bank of India,<br>
                            Hamirpur Main Branch
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- REPORT CONTENT (Continuous Flow) -->
        <div class="paper report-content">

            <!-- Section 1 -->
            <h3 class="section-header" contenteditable="true">1. Project at a Glance</h3>
            <table class="glance-table">
                <tr>
                    <td>1</td>
                    <td contenteditable="true">Name of Entrepreneur</td>
                    <td contenteditable="true">Mrs. Rajni Sheetal</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td contenteditable="true">Name of Enterprise</td>
                    <td contenteditable="true">M/s. Sheetal Cordyceps Farm</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td contenteditable="true">Constitution (Legal Status)</td>
                    <td contenteditable="true">Proprietorship</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td contenteditable="true">Father/Spouse Name</td>
                    <td contenteditable="true">Mr. Kamal Kumar Sharma</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td contenteditable="true">Unit Address</td>
                    <td contenteditable="true">Hamirpur, Himachal Pradesh</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td contenteditable="true">Contact Number</td>
                    <td contenteditable="true">+91 98765 43210</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td contenteditable="true">Product</td>
                    <td contenteditable="true">Dried Cordyceps Militaris (Medicinal Mushroom)</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td contenteditable="true">GSTIN</td>
                    <td contenteditable="true">02AAAAA0000A1Z5</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td contenteditable="true">Total Cost of Project</td>
                    <td contenteditable="true" id="glanceCost">6,00,000</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td contenteditable="true">Bank Loan (Term Loan + WC)</td>
                    <td contenteditable="true" id="glanceLoan">3,63,000</td>
                </tr>
                <tr>
                    <td>11</td>
                    <td contenteditable="true">Subsidy (PMEGP)</td>
                    <td contenteditable="true" id="glanceSubsidy">2,11,750</td>
                </tr>
                <tr>
                    <td>12</td>
                    <td contenteditable="true">Debt Service Coverage Ratio (DSCR)</td>
                    <td><span id="glanceDSCR">3.24</span> (Average)</td>
                </tr>
                <tr>
                    <td>13</td>
                    <td contenteditable="true">Pay Back Period</td>
                    <td contenteditable="true">5 Years</td>
                </tr>
                <tr>
                    <td>14</td>
                    <td contenteditable="true">Employment Generation</td>
                    <td contenteditable="true">3 Persons</td>
                </tr>
            </table>

            <!-- Section 2 -->
            <h3 class="section-header" contenteditable="true">2. Introduction & Market Potential</h3>
            <p contenteditable="true"><strong>Introduction:</strong> Cordyceps Militaris is a high-value medicinal
                mushroom known for its immune-boosting and energy-enhancing properties. Unlike the wild variety, it can
                be cultivated in controlled laboratory conditions. The global and Indian market for Cordyceps is growing
                rapidly due to rising health awareness post-pandemic.</p>
            <p contenteditable="true"><strong>Market Potential:</strong> With increasing urbanization and health
                consciousness, the demand for nutraceuticals is skyrocketing. Cordyceps commands a premium price in the
                market (₹80,000 - ₹1,00,000 per kg). The product has huge export potential as well as domestic demand in
                the ayurvedic and supplement industry.</p>

            <!-- Section 3 -->
            <h3 class="section-header" contenteditable="true">3. Manufacturing Process</h3>
            <p contenteditable="true">The cultivation process is technical and sterile:</p>
            <ol class="process-list" contenteditable="true">
                <li><span class="process-title">Substrate Preparation:</span> A mixture of brown rice and liquid
                    nutrients is filled into glass jars.</li>
                <li><span class="process-title">Sterilization:</span> Jars are autoclaved at 121°C to eliminate
                    contaminants.</li>
                <li><span class="process-title">Inoculation:</span> Liquid spawn is injected into jars under a Laminar
                    Air Flow (LAF) cabinet.</li>
                <li><span class="process-title">Dark Incubation:</span> Jars are kept in the dark at 20°C for 5-7 days
                    for mycelium growth.</li>
                <li><span class="process-title">Fruiting (Light Cycle):</span> Jars are moved to a grow room with LED
                    lights (12hr cycle) & controlled humidity for 50-60 days.</li>
                <li><span class="process-title">Harvesting & Drying:</span> Fruit bodies are harvested and dried in a
                    dehydrator to <5% moisture.</li>
            </ol>

            <!-- Section 4 -->
            <h3 class="section-header" contenteditable="true">4. Cost of Project</h3>
            <table id="costTable">
                <thead>
                    <tr>
                        <th width="10%">S.No.</th>
                        <th width="60%">Particulars</th>
                        <th width="30%">Amount (₹)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="text-center">1</td>
                        <td contenteditable="true">Civil Works / Lab Renovation</td>
                        <td class="amount-col" contenteditable="true"><span class="cost-item">60,000</span></td>
                    </tr>
                    <tr>
                        <td class="text-center">2</td>
                        <td contenteditable="true">Laminar Air Flow (LAF) Cabinet</td>
                        <td class="amount-col" contenteditable="true"><span class="cost-item">65,000</span></td>
                    </tr>
                    <tr>
                        <td class="text-center">3</td>
                        <td contenteditable="true">Vertical Autoclave (Sterilizer)</td>
                        <td class="amount-col" contenteditable="true"><span class="cost-item">45,000</span></td>
                    </tr>
                    <tr>
                        <td class="text-center">4</td>
                        <td contenteditable="true">Air Conditioner (1 Ton Inverter)</td>
                        <td class="amount-col" contenteditable="true"><span class="cost-item">35,000</span></td>
                    </tr>
                    <tr>
                        <td class="text-center">5</td>
                        <td contenteditable="true">Dehydrator & Packaging Tools</td>
                        <td class="amount-col" contenteditable="true"><span class="cost-item">25,000</span></td>
                    </tr>
                    <tr>
                        <td class="text-center">6</td>
                        <td contenteditable="true">Sensors, Humidifiers & IoT</td>
                        <td class="amount-col" contenteditable="true"><span class="cost-item">20,000</span></td>
                    </tr>
                    <tr>
                        <td class="text-center">7</td>
                        <td contenteditable="true">Power Generator (7.5 KVA)</td>
                        <td class="amount-col" contenteditable="true"><span class="cost-item">85,000</span></td>
                    </tr>
                    <tr>
                        <td class="text-center">8</td>
                        <td contenteditable="true">Heavy Duty Racks, Trays & Furniture</td>
                        <td class="amount-col" contenteditable="true"><span class="cost-item">85,000</span></td>
                    </tr>
                    <tr>
                        <td class="text-center">9</td>
                        <td contenteditable="true">Refrigerator (90L)</td>
                        <td class="amount-col" contenteditable="true"><span class="cost-item">15,000</span></td>
                    </tr>
                    <tr>
                        <td class="text-center">10</td>
                        <td contenteditable="true">Airtight Fan with HEPA Filter</td>
                        <td class="amount-col" contenteditable="true"><span class="cost-item">8,000</span></td>
                    </tr>
                    <tr>
                        <td class="text-center">11</td>
                        <td contenteditable="true">LED Grow Lights</td>
                        <td class="amount-col" contenteditable="true"><span class="cost-item">12,000</span></td>
                    </tr>
                    <tr>
                        <td class="text-center">12</td>
                        <td contenteditable="true">Working Capital Margin</td>
                        <td class="amount-col" contenteditable="true"><span class="cost-item wc-item">1,45,000</span>
                        </td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr style="background: #f0f0f0; font-weight: bold;">
                        <td colspan="2" class="text-right">Total Project Cost</td>
                        <td class="amount-col" id="totalProjectCost">6,00,000</td>
                    </tr>
                </tfoot>
            </table>
            <div class="text-right no-print"><button class="btn-add" onclick="addCostRow()">+ Add Item</button></div>

            <!-- Section 5 -->
            <h3 class="section-header" contenteditable="true">5. Means of Finance</h3>
            <table>
                <thead>
                    <tr>
                        <th>Particulars</th>
                        <th>Amount (₹)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td contenteditable="true">Own Contribution (5%)</td>
                        <td class="amount-col" id="mofOwn">30,000</td>
                    </tr>
                    <tr>
                        <td contenteditable="true">PMEGP Subsidy (35% Backend)</td>
                        <td class="amount-col" id="mofSubsidy">2,10,000</td>
                    </tr>
                    <tr>
                        <td contenteditable="true">Bank Term Loan (Balancing)</td>
                        <td class="amount-col" id="mofLoan">3,60,000</td>
                    </tr>
                    <tr style="background: #f0f0f0; font-weight: bold;">
                        <td class="text-right">Total</td>
                        <td class="amount-col" id="mofTotal">6,00,000</td>
                    </tr>
                </tbody>
            </table>
            <p style="font-size: 13px; font-style: italic; color: #555; margin-top: -10px;">* Note: The PMEGP Subsidy is
                front-ended but kept as a Fixed Deposit (TDR) for 3 years, to be adjusted against the loan thereafter.
            </p>

            <!-- Section 6 -->
            <h3 class="section-header" contenteditable="true">6. Projected Profitability Statement (5 Years)</h3>
            <p style="font-size: 13px; font-style: italic; text-align: right;">(Figures in ₹)</p>
            <table id="profitTable">
                <thead>
                    <tr>
                        <th>Particulars</th>
                        <th>Year 1</th>
                        <th>Year 2</th>
                        <th>Year 3</th>
                        <th>Year 4</th>
                        <th>Year 5</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="6" style="background: #eee; font-weight: bold;">A) PRODUCTION & SALES</td>
                    </tr>
                    <tr>
                        <td>Production (KG)</td>
                        <td class="amount-col" contenteditable="true"><span class="prod-qty">10</span></td>
                        <td class="amount-col prod-qty-2">11</td>
                        <td class="amount-col prod-qty-3">12</td>
                        <td class="amount-col prod-qty-4">13</td>
                        <td class="amount-col prod-qty-5">15</td>
                    </tr>
                    <tr>
                        <td>Price (₹/KG)</td>
                        <td class="amount-col" contenteditable="true"><span class="unit-price">80,000</span></td>
                        <td class="amount-col unit-price-2">82,400</td>
                        <td class="amount-col unit-price-3">84,872</td>
                        <td class="amount-col unit-price-4">87,418</td>
                        <td class="amount-col unit-price-5">90,041</td>
                    </tr>
                    <tr style="font-weight: bold; background: #e7f1ff;">
                        <td>Total Revenue</td>
                        <td class="amount-col y1-rev">8,00,000</td>
                        <td class="amount-col y2-rev">9,06,400</td>
                        <td class="amount-col y3-rev">10,18,464</td>
                        <td class="amount-col y4-rev">11,36,434</td>
                        <td class="amount-col y5-rev">13,50,615</td>
                    </tr>
                    <tr>
                        <td colspan="6" style="background: #eee; font-weight: bold;">B) EXPENDITURE</td>
                    </tr>
                    <tr>
                        <td>Raw Material</td>
                        <td class="amount-col" contenteditable="true"><span class="y1-exp">1,50,000</span></td>
                        <td class="amount-col y2-exp">1,65,000</td>
                        <td class="amount-col y3-exp">1,81,500</td>
                        <td class="amount-col y4-exp">1,99,650</td>
                        <td class="amount-col y5-exp">2,19,615</td>
                    </tr>
                    <tr>
                        <td>Electricity/Fuel</td>
                        <td class="amount-col" contenteditable="true"><span class="y1-elec">85,000</span></td>
                        <td class="amount-col y2-elec">93,500</td>
                        <td class="amount-col y3-elec">1,02,850</td>
                        <td class="amount-col y4-elec">1,13,135</td>
                        <td class="amount-col y5-elec">1,24,449</td>
                    </tr>
                    <tr>
                        <td>Wear & Tear</td>
                        <td class="amount-col">65,000</td>
                        <td class="amount-col">55,250</td>
                        <td class="amount-col">46,962</td>
                        <td class="amount-col">39,918</td>
                        <td class="amount-col">33,930</td>
                    </tr>
                    <tr style="font-weight: bold;">
                        <td>Total Exp (B)</td>
                        <td class="amount-col tot-exp-1">3,00,000</td>
                        <td class="amount-col tot-exp-2">3,13,750</td>
                        <td class="amount-col tot-exp-3">3,31,312</td>
                        <td class="amount-col tot-exp-4">3,52,703</td>
                        <td class="amount-col tot-exp-5">3,77,994</td>
                    </tr>
                    <tr style="background: #e7f1ff; font-weight: bold;">
                        <td>Gross Profit</td>
                        <td class="amount-col gp-1">5,00,000</td>
                        <td class="amount-col gp-2">5,92,650</td>
                        <td class="amount-col gp-3">6,87,152</td>
                        <td class="amount-col gp-4">7,83,731</td>
                        <td class="amount-col gp-5">9,72,621</td>
                    </tr>
                    <tr>
                        <td>Less: Interest</td>
                        <td class="amount-col int-1">36,000</td>
                        <td class="amount-col int-2">28,800</td>
                        <td class="amount-col int-3">21,600</td>
                        <td class="amount-col int-4">14,400</td>
                        <td class="amount-col int-5">7,200</td>
                    </tr>
                    <tr style="background: #d1e7dd; font-weight: bold;">
                        <td>NET PROFIT</td>
                        <td class="amount-col np-1">4,64,000</td>
                        <td class="amount-col np-2">5,63,850</td>
                        <td class="amount-col np-3">6,65,552</td>
                        <td class="amount-col np-4">7,69,331</td>
                        <td class="amount-col np-5">9,65,421</td>
                    </tr>
                </tbody>
            </table>

            <!-- Section 7 -->
            <h3 class="section-header" contenteditable="true">7. Projected Balance Sheet</h3>
            <table id="bsTable">
                <thead>
                    <tr>
                        <th>Liabilities</th>
                        <th>Year 1</th>
                        <th>Year 2</th>
                        <th>Year 3</th>
                        <th>Year 4</th>
                        <th>Year 5</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="6" style="background: #f0f0f0; font-weight: bold;">LIABILITIES</td>
                    </tr>
                    <tr>
                        <td>Capital</td>
                        <td class="amount-col cap-1">4,94,000</td>
                        <td class="amount-col cap-2">0</td>
                        <td class="amount-col cap-3">0</td>
                        <td class="amount-col cap-4">0</td>
                        <td class="amount-col cap-5">25,00,000</td>
                    </tr>
                    <tr>
                        <td>Term Loan</td>
                        <td class="amount-col tl-1">3,20,000</td>
                        <td class="amount-col tl-2">0</td>
                        <td class="amount-col tl-3">0</td>
                        <td class="amount-col tl-4">0</td>
                        <td class="amount-col tl-5">0</td>
                    </tr>
                    <tr>
                        <td>Current Liabilities</td>
                        <td class="amount-col">20,000</td>
                        <td class="amount-col">22,000</td>
                        <td class="amount-col">25,000</td>
                        <td class="amount-col">30,000</td>
                        <td class="amount-col">35,000</td>
                    </tr>
                    <tr style="font-weight: bold; background: #e9ecef;">
                        <td>Total Liabilities</td>
                        <td class="amount-col tot-liab-1">0</td>
                        <td class="amount-col tot-liab-2">0</td>
                        <td class="amount-col tot-liab-3">0</td>
                        <td class="amount-col tot-liab-4">0</td>
                        <td class="amount-col tot-liab-5">0</td>
                    </tr>

                    <tr>
                        <td colspan="6" style="background: #f0f0f0; font-weight: bold;">ASSETS</td>
                    </tr>
                    <tr>
                        <td>Gross Fixed Assets</td>
                        <td class="amount-col gfa">4,30,000</td>
                        <td class="amount-col gfa">4,30,000</td>
                        <td class="amount-col gfa">4,30,000</td>
                        <td class="amount-col gfa">4,30,000</td>
                        <td class="amount-col gfa">4,30,000</td>
                    </tr>
                    <tr>
                        <td>Less: Accum. Depreciation</td>
                        <td class="amount-col acc-dep-1">65,000</td>
                        <td class="amount-col acc-dep-2">0</td>
                        <td class="amount-col acc-dep-3">0</td>
                        <td class="amount-col acc-dep-4">0</td>
                        <td class="amount-col acc-dep-5">2,41,000</td>
                    </tr>
                    <tr>
                        <td>Net Fixed Assets</td>
                        <td class="amount-col nfa-1">0</td>
                        <td class="amount-col nfa-2">0</td>
                        <td class="amount-col nfa-3">0</td>
                        <td class="amount-col nfa-4">0</td>
                        <td class="amount-col nfa-5">0</td>
                    </tr>
                    <tr>
                        <td>Current Assets</td>
                        <td class="amount-col ca-1">0</td>
                        <td class="amount-col ca-2">0</td>
                        <td class="amount-col ca-3">0</td>
                        <td class="amount-col ca-4">0</td>
                        <td class="amount-col ca-5">0</td>
                    </tr>
                    <tr style="font-weight: bold; background: #e9ecef;">
                        <td>Total Assets</td>
                        <td class="amount-col tot-asset-1">0</td>
                        <td class="amount-col tot-asset-2">0</td>
                        <td class="amount-col tot-asset-3">0</td>
                        <td class="amount-col tot-asset-4">0</td>
                        <td class="amount-col tot-asset-5">0</td>
                    </tr>
                </tbody>
            </table>

            <!-- Section 8 -->
            <h3 class="section-header" contenteditable="true">8. Calculation of D.S.C.R.</h3>
            <table>
                <thead>
                    <tr>
                        <th>Particulars</th>
                        <th>Yr 1</th>
                        <th>Yr 2</th>
                        <th>Yr 3</th>
                        <th>Yr 4</th>
                        <th>Yr 5</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Net Profit+Dep+Int</td>
                        <td class="amount-col cash-1">5,65,000</td>
                        <td class="amount-col cash-2">6,47,900</td>
                        <td class="amount-col cash-3">7,34,114</td>
                        <td class="amount-col cash-4">8,23,649</td>
                        <td class="amount-col cash-5">10,06,551</td>
                    </tr>
                    <tr>
                        <td>Repayment</td>
                        <td class="amount-col rep-1">1,08,000</td>
                        <td class="amount-col rep-2">1,08,000</td>
                        <td class="amount-col rep-3">1,08,000</td>
                        <td class="amount-col rep-4">1,08,000</td>
                        <td class="amount-col rep-5">1,08,000</td>
                    </tr>
                    <tr style="font-weight: bold; background: #e2e3e5;">
                        <td>DSCR</td>
                        <td class="amount-col dscr-1">5.23</td>
                        <td class="amount-col dscr-2">5.99</td>
                        <td class="amount-col dscr-3">6.79</td>
                        <td class="amount-col dscr-4">7.62</td>
                        <td class="amount-col dscr-5">9.32</td>
                    </tr>
                    <tr>
                        <td colspan="6" class="text-center"><strong>Average DSCR: <span
                                    id="avgDSCR">6.99</span></strong></td>
                    </tr>
                </tbody>
            </table>

            <!-- Section 9: Repayment Schedule -->
            <h3 class="section-header" contenteditable="true">9. Repayment Schedule (Bank Loan)</h3>
            <p style="font-size: 13px; font-style: italic; text-align: right;">Assumed Interest Rate: 10% p.a. | Tenure:
                5 Years</p>
            <table id="repaymentTable">
                <thead>
                    <tr>
                        <th>Year</th>
                        <th>Opening Balance</th>
                        <th>Principal Repayment</th>
                        <th>Interest Payment</th>
                        <th>Closing Balance</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="text-center">1</td>
                        <td class="amount-col ob-1">0</td>
                        <td class="amount-col princ-1">0</td>
                        <td class="amount-col int-1">0</td>
                        <td class="amount-col cb-1">0</td>
                    </tr>
                    <tr>
                        <td class="text-center">2</td>
                        <td class="amount-col ob-2">0</td>
                        <td class="amount-col princ-2">0</td>
                        <td class="amount-col int-2">0</td>
                        <td class="amount-col cb-2">0</td>
                    </tr>
                    <tr>
                        <td class="text-center">3</td>
                        <td class="amount-col ob-3">0</td>
                        <td class="amount-col princ-3">0</td>
                        <td class="amount-col int-3">0</td>
                        <td class="amount-col cb-3">0</td>
                    </tr>
                    <tr>
                        <td class="text-center">4</td>
                        <td class="amount-col ob-4">0</td>
                        <td class="amount-col princ-4">0</td>
                        <td class="amount-col int-4">0</td>
                        <td class="amount-col cb-4">0</td>
                    </tr>
                    <tr>
                        <td class="text-center">5</td>
                        <td class="amount-col ob-5">0</td>
                        <td class="amount-col princ-5">0</td>
                        <td class="amount-col int-5">0</td>
                        <td class="amount-col cb-5">0</td>
                    </tr>
                </tbody>
            </table>

            <div class="signature-block">
                <div class="sign-box">
                    <div class="sign-line" contenteditable="true">Date:</div>
                </div>
                <div class="sign-box">
                    <div class="sign-line" contenteditable="true">Place:</div>
                </div>
                <div class="sign-box">
                    <div class="sign-line" contenteditable="true">Mrs. Rajni Sheetal<br>(Proprietor)</div>
                </div>
            </div>

            <div style="margin-top: 30px; font-size: 12px; color: #666; text-align: justify; font-weight: bold;"
                contenteditable="true">
                DISCLAIMER: This report is prepared based on market assumptions. Actual results may vary. This document
                is for bank appraisal purposes under PMEGP scheme.
            </div>
        </div>

        <!-- INVOICE 1 -->
        <div class="paper invoice-page">
            <h1 style="text-align: center; border-bottom: none;">QUOTATIONS / INVOICES</h1>
            <p style="text-align: center;">(Supporting Document 1: Machinery)</p>
            <br>
            <div class="invoice-box" contenteditable="true">
                <div class="invoice-header">
                    <div class="text-left">
                        <h2 style="margin:0;">Bio-Tech Lab Solutions</h2>
                        <small>Haridwar, UK | GSTIN: 05AAACB1234D1Z5</small>
                    </div>
                    <div class="text-right"><strong>PROFORMA INVOICE</strong><br>Date: 15-Oct-2023</div>
                </div>
                <div><strong>To:</strong> Mrs. Rajni Sheetal, Hamirpur</div>
                <br>
                <table>
                    <tr style="background:#f0f0f0;">
                        <th>Description</th>
                        <th>Qty</th>
                        <th>Rate</th>
                        <th>Amount</th>
                    </tr>
                    <tr>
                        <td>Laminar Air Flow Cabinet (SS 304)</td>
                        <td>1</td>
                        <td class="text-right">65,000</td>
                        <td class="text-right">65,000</td>
                    </tr>
                    <tr>
                        <td>Vertical Autoclave (High Pressure)</td>
                        <td>1</td>
                        <td class="text-right">45,000</td>
                        <td class="text-right">45,000</td>
                    </tr>
                    <tr>
                        <td>Commercial Dehydrator (12 Tray)</td>
                        <td>1</td>
                        <td class="text-right">25,000</td>
                        <td class="text-right">25,000</td>
                    </tr>
                    <tr>
                        <td>IoT Sensors & Humidifiers Set</td>
                        <td>1</td>
                        <td class="text-right">20,000</td>
                        <td class="text-right">20,000</td>
                    </tr>
                    <tr style="font-weight: bold;">
                        <td colspan="3" class="text-right">Total</td>
                        <td class="text-right">1,55,000</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- INVOICE 2 -->
        <div class="paper invoice-page">
            <p style="text-align: center;">(Supporting Document 2: Electricals)</p>
            <br>
            <div class="invoice-box" contenteditable="true">
                <div class="invoice-header">
                    <div class="text-left">
                        <h2 style="margin:0;">PowerGen & Electronics</h2>
                        <small>Hamirpur, HP | GSTIN: 05BBBCZ9876K1Z9</small>
                    </div>
                    <div class="text-right"><strong>QUOTATION</strong><br>Date: 18-Oct-2023</div>
                </div>
                <div><strong>To:</strong> Mrs. Rajni Sheetal, Hamirpur</div>
                <br>
                <table>
                    <tr style="background:#f0f0f0;">
                        <th>Description</th>
                        <th>Qty</th>
                        <th>Rate</th>
                        <th>Amount</th>
                    </tr>
                    <tr>
                        <td>7.5 KVA Silent Diesel Generator</td>
                        <td>1</td>
                        <td class="text-right">85,000</td>
                        <td class="text-right">85,000</td>
                    </tr>
                    <tr>
                        <td>LED Grow Lights (Full Spectrum)</td>
                        <td>10</td>
                        <td class="text-right">1,200</td>
                        <td class="text-right">12,000</td>
                    </tr>
                    <tr>
                        <td>Refrigerator 90L</td>
                        <td>1</td>
                        <td class="text-right">15,000</td>
                        <td class="text-right">15,000</td>
                    </tr>
                    <tr>
                        <td>Airtight Inline Fan with HEPA</td>
                        <td>1</td>
                        <td class="text-right">8,000</td>
                        <td class="text-right">8,000</td>
                    </tr>
                    <tr style="font-weight: bold;">
                        <td colspan="3" class="text-right">Total</td>
                        <td class="text-right">1,20,000</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- INVOICE 3 -->
        <div class="paper invoice-page">
            <p style="text-align: center;">(Supporting Document 3: Civil & Fabrication)</p>
            <br>
            <div class="invoice-box" contenteditable="true">
                <div class="invoice-header">
                    <div class="text-left">
                        <h2 style="margin:0;">Doon Interiors</h2>
                        <small>Hamirpur, HP | GSTIN: 05DDDFA4567M1Z2</small>
                    </div>
                    <div class="text-right"><strong>ESTIMATE</strong><br>Date: 20-Oct-2023</div>
                </div>
                <div><strong>To:</strong> Mrs. Rajni Sheetal, Hamirpur</div>
                <br>
                <table>
                    <tr style="background:#f0f0f0;">
                        <th>Description</th>
                        <th>Qty</th>
                        <th>Rate</th>
                        <th>Amount</th>
                    </tr>
                    <tr>
                        <td>Renovation & PUF Insulation</td>
                        <td>1</td>
                        <td class="text-right">60,000</td>
                        <td class="text-right">60,000</td>
                    </tr>
                    <tr>
                        <td>Heavy Duty Steel Racks</td>
                        <td>8</td>
                        <td class="text-right">8,000</td>
                        <td class="text-right">64,000</td>
                    </tr>
                    <tr>
                        <td>Work Tables & Furniture</td>
                        <td>1</td>
                        <td class="text-right">21,000</td>
                        <td class="text-right">21,000</td>
                    </tr>
                    <tr style="font-weight: bold;">
                        <td colspan="3" class="text-right">Total</td>
                        <td class="text-right">1,45,000</td>
                    </tr>
                </table>
            </div>
        </div>

    </div>

    <script>
        function parseNum(str) {
            if (!str) return 0;
            return parseFloat(str.replace(/,/g, '').replace(/[^0-9.]/g, "")) || 0;
        }

        function formatNum(num) {
            return new Intl.NumberFormat('en-IN', { maximumFractionDigits: 0 }).format(num);
        }

        function addCostRow() {
            const tableBody = document.querySelector("#costTable tbody");
            const rowCount = tableBody.rows.length + 1;
            const row = document.createElement("tr");
            row.innerHTML = `<td class="text-center">${rowCount}</td><td contenteditable="true">New Item</td><td class="amount-col" contenteditable="true"><span class="cost-item">0</span><span class="delete-btn" onclick="this.parentElement.parentElement.remove(); calculateAll(this);">×</span></td>`;
            // Insert before the last row (which is now Working Capital)
            const wcRow = tableBody.lastElementChild;
            tableBody.insertBefore(row, wcRow);

            // Renumber the WC row
            wcRow.cells[0].innerText = rowCount + 1;

            row.querySelector('.cost-item').parentElement.addEventListener('blur', function (e) {
                calculateAll(e.target);
            });
        }

        function calculateAll(sourceElement) {
            const FIXED_TOTAL = 600000;
            let totalCost = 0;
            let sumOthers = 0;
            const wcRow = document.querySelector("#costTable tbody tr:last-child");
            const wcAmountCell = wcRow.querySelector('.wc-item'); // Assuming we add this class or just find last row cell
            // In the HTML I added 'wc-item' class to the Working Capital cell: <span class="cost-item wc-item">1,45,000</span>

            const costItems = document.querySelectorAll('.cost-item');

            // Determine if we need to balance Working Capital
            // We balance if the source of edit is NOT the Working Capital itself
            let shouldBalance = true;
            if (sourceElement && sourceElement.querySelector) {
                if (sourceElement.querySelector('.wc-item')) {
                    shouldBalance = false;
                }
            } else if (sourceElement && sourceElement.classList && sourceElement.classList.contains('wc-item')) {
                shouldBalance = false;
            } else if (sourceElement && sourceElement.parentElement && sourceElement.parentElement.querySelector('.wc-item')) {
                shouldBalance = false;
            }

            if (shouldBalance) {
                // Sum all items EXCEPT the last one (Working Capital)
                // Note: costItems includes the WC item, so we iterate carefully
                costItems.forEach(item => {
                    if (!item.classList.contains('wc-item')) {
                        sumOthers += parseNum(item.innerText);
                    }
                });

                let newWC = FIXED_TOTAL - sumOthers;
                if (newWC < 0) newWC = 0; // Prevent negative, though this means Total will exceed 6L

                if (wcAmountCell) {
                    wcAmountCell.innerText = formatNum(newWC);
                }
            }

            // 1. Recalculate Total Costs (Now that WC is updated)
            totalCost = 0;
            document.querySelectorAll('.cost-item').forEach(i => totalCost += parseNum(i.innerText));
            document.getElementById('totalProjectCost').innerText = formatNum(totalCost);
            document.getElementById('glanceCost').innerText = formatNum(totalCost);

            // 2. Finance
            let own = totalCost * 0.05, subsidy = totalCost * 0.35, loan = totalCost - own - subsidy;
            document.getElementById('mofOwn').innerText = formatNum(own);
            document.getElementById('mofSubsidy').innerText = formatNum(subsidy);
            document.getElementById('mofLoan').innerText = formatNum(loan);
            document.getElementById('mofTotal').innerText = formatNum(totalCost);
            document.getElementById('glanceLoan').innerText = formatNum(loan);
            document.getElementById('glanceSubsidy').innerText = formatNum(subsidy);

            // 3. Projections & Repayment
            let years = [1, 2, 3, 4, 5], loanBal = loan, loanPrincipal = loan / 5, dscrSum = 0;
            let qty = parseNum(document.querySelector('.prod-qty').innerText);
            let price = parseNum(document.querySelector('.unit-price').innerText);
            document.querySelector('.y1-rev').innerText = formatNum(qty * price);

            let accumCapital = own;
            let accumDepreciation = 0;
            let grossBlock = 430000; // Fixed Assets approx (Total - WC)
            // Dynamically calculate gross block for balance sheet
            // Gross Block = Total Cost - Working Capital
            let currentWC = parseNum(document.querySelector('.wc-item').innerText);
            grossBlock = totalCost - currentWC;

            let repayLoanBal = loan;

            years.forEach((y, i) => {
                // Growth Logic
                if (y > 1) {
                    let prevQty = parseNum(document.querySelector(y === 2 ? '.prod-qty' : `.prod-qty-${y - 1}`).innerText);
                    let prevPrice = parseNum(document.querySelector(y === 2 ? '.unit-price' : `.unit-price-${y - 1}`).innerText);
                    let newQty = prevQty * 1.10, newPrice = prevPrice * 1.03;
                    document.querySelector(`.prod-qty-${y}`).innerText = formatNum(Math.round(newQty));
                    document.querySelector(`.unit-price-${y}`).innerText = formatNum(Math.round(newPrice));
                    document.querySelector(`.y${y}-rev`).innerText = formatNum(Math.round(newQty * newPrice));

                    document.querySelector(`.y${y}-exp`).innerText = formatNum(parseNum(document.querySelector(`.y${y - 1}-exp`).innerText) * 1.10);
                    document.querySelector(`.y${y}-elec`).innerText = formatNum(parseNum(document.querySelector(`.y${y - 1}-elec`).innerText) * 1.10);
                }

                // P&L Calcs
                let s = parseNum(document.querySelector(`.y${y}-rev`).innerText);
                let exp = parseNum(document.querySelector(`.y${y}-exp`).innerText) + parseNum(document.querySelector(`.y${y}-elec`).innerText);
                let dep = y === 1 ? 65000 : y === 2 ? 55250 : y === 3 ? 46962 : y === 4 ? 39918 : 33930;
                let totExp = exp + dep;
                document.querySelector(`.tot-exp-${y}`).innerText = formatNum(totExp);

                let gp = s - totExp;
                document.querySelector(`.gp-${y}`).innerText = formatNum(gp);

                // Interest & Loan Logic
                let int = loanBal * 0.10; // 10% Interest

                // Update Profitability Table Interest
                let intCell = document.querySelector(`.int-${y}`);
                if (intCell) intCell.innerText = formatNum(int);

                // Update Repayment Schedule Table
                document.querySelector(`.ob-${y}`).innerText = formatNum(loanBal);
                document.querySelector(`.princ-${y}`).innerText = formatNum(loanPrincipal);

                let intCells = document.querySelectorAll(`.int-${y}`);
                intCells.forEach(cell => cell.innerText = formatNum(int));

                let closingBal = Math.max(0, loanBal - loanPrincipal);
                document.querySelector(`.cb-${y}`).innerText = formatNum(closingBal);

                // Reduce Loan for next iteration
                let currentLoanBal = loanBal;
                loanBal -= loanPrincipal;

                let np = gp - int;
                document.querySelector(`.np-${y}`).innerText = formatNum(np);

                let cash = np + dep + int, repay = loanPrincipal + int;
                let dscr = cash / repay;
                document.querySelector(`.cash-${y}`).innerText = formatNum(cash);
                document.querySelector(`.rep-${y}`).innerText = formatNum(repay);
                document.querySelector(`.dscr-${y}`).innerText = dscr.toFixed(2);
                dscrSum += dscr;

                // --- Balance Sheet Updates ---
                accumCapital += np;
                accumDepreciation += dep;
                let netBlock = grossBlock - accumDepreciation;

                document.querySelector(`.cap-${y}`).innerText = formatNum(accumCapital);
                document.querySelector(`.tl-${y}`).innerText = formatNum(closingBal);
                let creditors = 20000 + (y * 3000);

                let totalLiab = accumCapital + closingBal + creditors;
                document.querySelector(`.tot-liab-${y}`).innerText = formatNum(totalLiab);

                document.querySelector(`.gfa`).innerText = formatNum(grossBlock); // Update all GFA cells
                document.querySelectorAll('.gfa').forEach(el => el.innerText = formatNum(grossBlock));

                document.querySelector(`.acc-dep-${y}`).innerText = formatNum(accumDepreciation);
                document.querySelector(`.nfa-${y}`).innerText = formatNum(netBlock);

                let currAssets = totalLiab - netBlock;
                document.querySelector(`.ca-${y}`).innerText = formatNum(currAssets);
                document.querySelector(`.tot-asset-${y}`).innerText = formatNum(totalLiab);
            });

            let avgDscr = dscrSum / 5;
            document.getElementById('avgDSCR').innerText = avgDscr.toFixed(2);
            document.getElementById('glanceDSCR').innerText = avgDscr.toFixed(2);
        }

        document.addEventListener('DOMContentLoaded', function () {
            calculateAll();
        });

        document.querySelectorAll('[contenteditable="true"]').forEach(el => {
            el.addEventListener('blur', function (e) {
                if (this.classList.contains('cost-item') ||
                    this.classList.contains('prod-qty') ||
                    this.classList.contains('unit-price') ||
                    this.classList.contains('y1-exp')) {
                    calculateAll(e.target); // Pass the element that was edited
                }
            });
            el.addEventListener('keypress', (e) => { if (e.key === 'Enter') e.target.blur(); });
        });
    </script>
</body>

</html>